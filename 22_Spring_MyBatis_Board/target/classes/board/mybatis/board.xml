<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board.BoardBean">
	<select id="GetTotalCount" resultType="int">
		select count(*) from board
		<if test="whtColumn == '제목'">
			where subject = #{keyword}
		</if>
		<if test="whtColumn == '글쓴이'">
			where writer = #{keyword}
		</if>
	</select>

	<select id="GetBoardList" resultType="myBoard">
		select * from board
		<if test="whtColumn == '제목'">
			where subject = #{keyword}
		</if>
		<if test="whtColumn == '글쓴이'">
			where writer = #{keyword}
		</if>
		order by num desc
	</select>
	
	<insert id="InsertBoard">
		insert into board(num,writer,subject,email,content,passwd,reg_date,ref,re_step,re_level,ip)
		values(board_seq.nextval,#{writer},#{subject},#{email},#{content},#{passwd},sysdate,board_seq.currval,0,0,#{ip})
	</insert>

	<select id="GetBoardByNum" resultType="myBoard">
		select * from board
		where num = #{num}
	</select>

	<select id="CheckByPasswd" resultType="myBoard">
		select * from board
		where num = #{num}, passwd = #{passwd}
	</select>
	
	<update id="UpdateBoard">
		update board set writer = #{writer},
	 	subject = #{subject}, email = #{email},
	 	content = #{content}, passwd = #{passwd}
	 	where num = #{num}
	</update>
	
	<delete id="DeleteBoard">
		delete board where num = #{num}
	</delete>
	
	<update id="UpdateReplyCount">
		update board set restep = restep+1
		where ref = #{ref} and restep > #{restep}
	</update>
	
	<insert id="InsertReply">
		insert into board(num,writer,subject,email,content,passwd,reg_date,ref,re_step,re_level,ip)
		values(board_seq.nextval,#{writer},#{subject},#{email},#{content},#{passwd},sysdate,#{ref},#{restep},#{relevel},#{ip})
	</insert>
</mapper>